<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handle Bitfields to record Data-Quality • queuebee</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Handle Bitfields to record Data-Quality">
<meta property="og:description" content="Provides tools to record formal data quality and meta data to store 
    that in a bitfield, which can be published alongside all sort of (modelled) 
    data products that can be handled in tabular form.">
<meta property="og:image" content="http://EhrmannS.github.io/queuebee/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">queuebee</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/queuebee.html">Get Started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EhrmannS/queuebee" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="bitfield-">bitfield <a href="https://github.com/luckinet/bitfield/" class="external-link"><img src="reference/figures/logo.svg" align="right" height="200"></a>
<a class="anchor" aria-label="anchor" href="#bitfield-"></a>
</h1></div>
<!-- badges: start -->
<!-- [![CRAN\_Status\_Badge](http://www.r-pkg.org/badges/version/)](https://cran.r-project.org/package=) -->
<!-- [![DOI](https://zenodo.org/badge/DOI/)](https://doi.org/) -->

<!-- [![](http://cranlogs.r-pkg.org/badges/grand-total/)](https://cran.r-project.org/package=) -->
<!-- badges: end -->
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This package is designed to build sequences of bits for any setting where large amounts of non-complex data have to be stored in an efficient way. This can also be useful when documenting the metadata of any tabular dataset by collecting information throughout the dataset creation process. The resulting data structure is referred to as a “<a href="https://en.wikipedia.org/wiki/Bit_field" class="external-link">bit field</a>”, which can be stored as a sequence of 0s and 1s, or as an integer, reducing the size of the contained information drastically. This is commonly used in MODIS dataproducts to document layer quality.</p>
<p>Think of a bit as a switch representing off and on states. A combination of a pair of bits can store four states, and n bits can accommodate 2^n states. In R, integers are typically 32-bit values, allowing a single integer to store 32 switches (called <code>flags</code> here) and 2^32 states. These states could be the outcomes of functions returning boolean values (each using one bit) or functions returning a small set of cases (using the corresponding number of bits).</p>
<p>In essence, <code>bitfield</code> allows you to capture a diverse range of information into a single value, like a column in a table or a raster layer accompanying a modelled gridded dataset. This is beneficial not only for reporting quality metrics, provenance, or other metadata but also for simplifying the reuse of complex ancillary data in (semi) automated script-based workflows.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the official version from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("bitfield")</span></span></code></pre></div>
<p>Install the latest development version from github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"luckinet/bitfield"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/luckinet/bitfield" class="external-link">bitfield</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.github.io/CoordinateCleaner/" class="external-link">CoordinateCleaner</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<p>Let’s first build an example dataset</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">23.3</span>, <span class="fl">28.1</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">57.5</span>, <span class="fl">59.6</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                commodity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"soybean"</span>, <span class="st">"maize"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, mean <span class="op">=</span> <span class="fl">10</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2021</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validComm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"soybean"</span>, <span class="st">"maize"</span><span class="op">)</span></span></code></pre></div>
<p>And make it have some non-ordinary values</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">259</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co"># input$x[10] &lt;- "23.546"</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">commodity</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_character_</span>, <span class="st">"honey"</span><span class="op">)</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"2021r"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">x</th>
<th align="right">y</th>
<th align="left">commodity</th>
<th align="right">yield</th>
<th align="left">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">24.1</td>
<td align="right">59.4</td>
<td align="left">soybean</td>
<td align="right">10.109169</td>
<td align="left">2021</td>
</tr>
<tr class="even">
<td align="right">24.0</td>
<td align="right">58.8</td>
<td align="left">maize</td>
<td align="right">10.617382</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">27.3</td>
<td align="right">58.4</td>
<td align="left">NA</td>
<td align="right">9.268043</td>
<td align="left">2021r</td>
</tr>
<tr class="even">
<td align="right">26.8</td>
<td align="right">58.1</td>
<td align="left">maize</td>
<td align="right">8.948955</td>
<td align="left">2021</td>
</tr>
<tr class="odd">
<td align="right">259.0</td>
<td align="right">57.9</td>
<td align="left">honey</td>
<td align="right">9.859947</td>
<td align="left">2021</td>
</tr>
<tr class="even">
<td align="right">23.7</td>
<td align="right">59.1</td>
<td align="left">maize</td>
<td align="right">6.318179</td>
<td align="left">2021</td>
</tr>
<tr class="odd">
<td align="right">24.2</td>
<td align="right">58.7</td>
<td align="left">soybean</td>
<td align="right">11.860984</td>
<td align="left">2021</td>
</tr>
<tr class="even">
<td align="right">25.1</td>
<td align="right">59.0</td>
<td align="left">maize</td>
<td align="right">11.278150</td>
<td align="left">2021</td>
</tr>
<tr class="odd">
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="left">soybean</td>
<td align="right">9.949784</td>
<td align="left">2021</td>
</tr>
<tr class="even">
<td align="right">24.7</td>
<td align="right">NA</td>
<td align="left">maize</td>
<td align="right">9.670879</td>
<td align="left">2021</td>
</tr>
</tbody>
</table>
<p>The first step is in creating what is called registry in <code>bitfield</code>. This registry captures all the information required to build the bitfield</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newRegistry</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bf_create.html">bf_create</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">12</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>The <code>width =</code> specifies how many bits are in the registry.</li>
<li>The <code>lenght =</code> specifies how long the output table is. This is usually taken from an input.</li>
<li>The <code>name =</code> specifies the label of the registry, which becomes very important when publishing, because registry and output table are stored in different files and it must be possible to unambiguously associate them to one another.</li>
</ol>
<p>Then, individual bit flags need to be grown by specifying a mapping function and which position of the bitfield should be modified. To help with growing bits, various naming-rules are important to keep in mind</p>
<ol style="list-style-type: decimal">
<li>if your mapping function returns a boolean value, the bit flags will be <code>FALSE == 0</code> and <code>TRUE == 1</code>.</li>
<li>if your mapping function returns cases, they will be assigned a sequence of numbers that are encoded by their respective binary representation, i.e. if there are 3 cases (which takes up 2 bits), the bit flags will be <code>case 1 = 00</code>, <code>case 2 == 01</code> and <code>case 3 == 10</code>, and so on.</li>
</ol>
<p>A flag is declared by calling a suitable function, some of which are provided here, but some of which are already available elsewhere (more below). For example <code>bf_na(x = input, test = "x")</code> will test whether the column <code>x</code> in the table <code>input</code> has <code>NA</code>-values. These functions are provided to <code><a href="reference/bf_grow.html">bf_grow()</a></code>, where the bitfield is characterised.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newRegistry</span> <span class="op">&lt;-</span> <span class="va">newRegistry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># tests for coordinates ...</span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="fu"><a href="reference/bf_na.html">bf_na</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input</span>, test <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">1</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span>  <span class="fu"><a href="reference/bf_range.html">bf_range</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input</span>, test <span class="op">=</span> <span class="st">"x"</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">180</span>, max <span class="op">=</span> <span class="fl">180</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">2</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="fu"><a href="reference/bf_decimals.html">bf_decimals</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input</span>, test <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">11</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># ... or override NA test</span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="fu"><a href="reference/bf_range.html">bf_range</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input</span>, test <span class="op">=</span> <span class="st">"y"</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, max <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">3</span>, na_val <span class="op">=</span> <span class="cn">FALSE</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span></span>
<span>  <span class="co"># test for matches with an external vector</span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="fu"><a href="reference/bf_match.html">bf_match</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input</span>, test <span class="op">=</span> <span class="st">"commodity"</span>, against <span class="op">=</span> <span class="va">validComm</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">4</span>, na_val <span class="op">=</span> <span class="cn">FALSE</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># define cases</span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="fu"><a href="reference/bf_case.html">bf_case</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input</span>, exclusive <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                          high <span class="op">=</span> <span class="va">yield</span> <span class="op">&gt;</span> <span class="fl">11</span>, </span>
<span>                          medium <span class="op">=</span> <span class="va">yield</span> <span class="op">&lt;</span> <span class="fl">11</span> <span class="op">&amp;</span> <span class="va">yield</span> <span class="op">&gt;</span> <span class="fl">9</span>, </span>
<span>                          small <span class="op">=</span> <span class="va">yield</span> <span class="op">&lt;</span> <span class="fl">9</span><span class="op">)</span>, </span>
<span>          pos <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">9</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>It is also possible to use other functions that return flags, where it is required to provide a name and a concise yet expressive description, which is otherwise automatically provided by the <code>bf_*</code> function. Then you need to keep in mind:</p>
<ol start="3" style="list-style-type: decimal">
<li>chose name and description so that they reflect the outcome of the mapping function. If the function tests whether a value is <code>NA</code> and returns <code>TRUE</code> if the value is <code>NA</code>, the name and description should indicate that the bit flag is <code>TRUE == 1</code> when an <code>NA</code> value has been found.</li>
<li>A concise rule to name flags should follow the same rule used by the <code>bf_*</code> functions, where the functional aspect is followed by the variable that is tested, for example <code>distinct_x_y</code> when columns <code>x</code> and <code>y</code> shall have distinct values.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newRegistry</span> <span class="op">&lt;-</span> <span class="va">newRegistry</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># use external functions, such as from CoordinateCleaner ...</span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="fu">cc_equ</span><span class="op">(</span>x <span class="op">=</span> <span class="va">input</span>, lon <span class="op">=</span> <span class="st">"x"</span>, lat <span class="op">=</span> <span class="st">"y"</span>, value <span class="op">=</span> <span class="st">"flagged"</span><span class="op">)</span>, </span>
<span>          name <span class="op">=</span> <span class="st">"distinct_x_y"</span>, desc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x and y coordinates are not identical, NAs are FALSE"</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">5</span>, na_val <span class="op">=</span> <span class="cn">FALSE</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># ... or stringr ...</span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year</span>, <span class="st">"r"</span><span class="op">)</span>, </span>
<span>          name <span class="op">=</span> <span class="st">"flag_year"</span>, desc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year values do have a flag, NAs are FALSE"</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">6</span>, na_val <span class="op">=</span> <span class="cn">FALSE</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># ... or even base R</span></span>
<span>  <span class="fu"><a href="reference/bf_grow.html">bf_grow</a></span><span class="op">(</span>flags <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, </span>
<span>          name <span class="op">=</span> <span class="st">"valid_year"</span>, desc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year values are valid integers"</span><span class="op">)</span>,</span>
<span>          pos <span class="op">=</span> <span class="fl">7</span>, registry <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span>
<span><span class="co">#&gt; Testing equal lat/lon</span></span>
<span><span class="co">#&gt; Flagged NA records.</span></span>
<span><span class="co">#&gt; Warning in bf_grow(flags = !is.na(as.integer(input$year)), name = "valid_year",</span></span>
<span><span class="co">#&gt; : NAs durch Umwandlung erzeugt</span></span></code></pre></div>
<p>The resulting strcuture is basically a record of all the things that are grown on the bitfield.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newRegistry</span></span></code></pre></div>
<p>Finally the registry needs to be combined (note: input data vectors have been stored into the environment <code>bf_env</code>). This will result in a vector of integers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">intBit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bf_combine.html">bf_combine</a></span><span class="op">(</span>registry <span class="op">=</span> <span class="va">newRegistry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 735 159 695 863 213 863 607 607 207 715</span></span></code></pre></div>
<p>As mentioned above, the registry is a record of things, which is required to decode the bitfield (similar to a key). Together with the legend, the bit flags can then be converted back to human readable text or used in any downstream workflow.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bitfield</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bf_unpack.html">bf_unpack</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">intBit</span>, registry <span class="op">=</span> <span class="va">newRegistry</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 9 × 4</span></span>
<span><span class="co">#&gt;   name            flags pos   description                                       </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;           &lt;int&gt; &lt;chr&gt; &lt;chr&gt;                                             </span></span>
<span><span class="co">#&gt; 1 not_na_x            2 1     the values in column 'x' do not contain any NAs   </span></span>
<span><span class="co">#&gt; 2 range_x             2 2     the values in column 'x' range between [-180,180] </span></span>
<span><span class="co">#&gt; 3 range_y             2 3     the values in column 'y' range between [-90,90]   </span></span>
<span><span class="co">#&gt; 4 match_commodity     2 4     the values in column 'commodity' are contained in…</span></span>
<span><span class="co">#&gt; 5 distinct_x_y        2 5     x and y coordinates are not identical, NAs are FA…</span></span>
<span><span class="co">#&gt; 6 flag_year           2 6     year values do have a flag, NAs are FALSE         </span></span>
<span><span class="co">#&gt; 7 valid_year          2 7     year values are valid integers                    </span></span>
<span><span class="co">#&gt; 8 cases               3 8:9   the values are split into the following cases [1:…</span></span>
<span><span class="co">#&gt; 9 decimals            2 10:11 the values in 'x' have 0|1 decimals</span></span>
<span></span>
<span><span class="co"># -&gt; prints legend by default, which is also available in bf_env$legend</span></span>
<span></span>
<span><span class="va">input</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">bitfield</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="9%">
<col width="8%">
<col width="15%">
<col width="15%">
<col width="9%">
<col width="11%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th align="right">x</th>
<th align="right">y</th>
<th align="left">commodity</th>
<th align="right">yield</th>
<th align="left">year</th>
<th align="right">bf_int</th>
<th align="left">bf_binary</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">24.1</td>
<td align="right">59.4</td>
<td align="left">soybean</td>
<td align="right">10.109169</td>
<td align="left">2021</td>
<td align="right">735</td>
<td align="left">1-1-1-1-1-0-1-10-10</td>
</tr>
<tr class="even">
<td align="right">24.0</td>
<td align="right">58.8</td>
<td align="left">maize</td>
<td align="right">10.617382</td>
<td align="left">NA</td>
<td align="right">159</td>
<td align="left">1-1-1-1-1-0-0-10-00</td>
</tr>
<tr class="odd">
<td align="right">27.3</td>
<td align="right">58.4</td>
<td align="left">NA</td>
<td align="right">9.268043</td>
<td align="left">2021r</td>
<td align="right">695</td>
<td align="left">1-1-1-0-1-1-0-10-10</td>
</tr>
<tr class="even">
<td align="right">26.8</td>
<td align="right">58.1</td>
<td align="left">maize</td>
<td align="right">8.948955</td>
<td align="left">2021</td>
<td align="right">863</td>
<td align="left">1-1-1-1-1-0-1-01-10</td>
</tr>
<tr class="odd">
<td align="right">259.0</td>
<td align="right">57.9</td>
<td align="left">honey</td>
<td align="right">9.859947</td>
<td align="left">2021</td>
<td align="right">213</td>
<td align="left">1-0-1-0-1-0-1-10-00</td>
</tr>
<tr class="even">
<td align="right">23.7</td>
<td align="right">59.1</td>
<td align="left">maize</td>
<td align="right">6.318179</td>
<td align="left">2021</td>
<td align="right">863</td>
<td align="left">1-1-1-1-1-0-1-01-10</td>
</tr>
<tr class="odd">
<td align="right">24.2</td>
<td align="right">58.7</td>
<td align="left">soybean</td>
<td align="right">11.860984</td>
<td align="left">2021</td>
<td align="right">607</td>
<td align="left">1-1-1-1-1-0-1-00-10</td>
</tr>
<tr class="even">
<td align="right">25.1</td>
<td align="right">59.0</td>
<td align="left">maize</td>
<td align="right">11.278150</td>
<td align="left">2021</td>
<td align="right">607</td>
<td align="left">1-1-1-1-1-0-1-00-10</td>
</tr>
<tr class="odd">
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="left">soybean</td>
<td align="right">9.949784</td>
<td align="left">2021</td>
<td align="right">207</td>
<td align="left">1-1-1-1-0-0-1-10-00</td>
</tr>
<tr class="even">
<td align="right">24.7</td>
<td align="right">NA</td>
<td align="left">maize</td>
<td align="right">9.670879</td>
<td align="left">2021</td>
<td align="right">715</td>
<td align="left">1-1-0-1-0-0-1-10-10</td>
</tr>
</tbody>
</table>
<p>Together with the rules mentioned above, we can read the binary representation on step at a time. For example, considering the second position, with the description <code>the values in column 'x' range between [-180,180]</code>, we see that row five has the value <code>0</code>, which means according to naming-rule 1 (<code>FALSE == 0</code>), that the x-value here should be outside of the range of [-180, 180], which we can confirm.</p>
</div>
<div class="section level2">
<h2 id="bitfields-for-other-data-types">Bitfields for other data-types<a class="anchor" aria-label="anchor" href="#bitfields-for-other-data-types"></a>
</h2>
<p>This example here shows how to compute quality bits for tabular data, but this technique is especially helpful for raster data. To keep this package as simple as possible, no specific methods for rasters were developed (so far), they instead need to be converted to tabular form and joined to the attributes or meta data that should be added to the QB, for example like this</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">raster</span> <span class="op">&lt;-</span> <span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu">values</span><span class="op">(</span><span class="va">raster</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">lyr.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu">crds</span><span class="op">(</span><span class="va">raster</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># from here we can continue creating a bitfield and growing bits on it just like shown above...</span></span>
<span><span class="va">intBit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bf_combine.html">bf_combine</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... and then converting it back to a raster</span></span>
<span><span class="va">QB_rast</span> <span class="op">&lt;-</span> <span class="fu">crds</span><span class="op">(</span><span class="va">raster</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">intBit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">rast</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"xyz"</span>, crs <span class="op">=</span> <span class="fu">crs</span><span class="op">(</span><span class="va">raster</span><span class="op">)</span>, extent <span class="op">=</span> <span class="fu">ext</span><span class="op">(</span><span class="va">raster</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="to-do">To Do<a class="anchor" aria-label="anchor" href="#to-do"></a>
</h1>
<ul>
<li>write registry show method</li>
<li>include MD5 sum for a bitfield and update it each time the bitfield is grown further</li>
</ul>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/luckinet/bitfield/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/luckinet/bitfield/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bitfield</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://orcid.org/0000-0002-2958-0796" class="external-link">Steffen Ehrmann</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-2958-0796" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://orcid.org/0000-0002-2958-0796" class="external-link">Steffen Ehrmann</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
